<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="pageTitle">PooPeelator - Lifetime Waste Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #333;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            transform: translateY(0);
            transition: transform 0.3s ease;
        }

        .container:hover {
            transform: translateY(-5px);
        }

        h1 {
            text-align: center;
            color: #5a67d8;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .emoji { /* For consistent emoji display if needed, though usually handled by font */
            font-size: 1em; /* Relative to parent h1 */
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
            font-size: 1.1em;
        }

        input, select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        button:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: scale(0.98);
        }

        .results {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #f6f9fc 0%, #e9ecef 100%);
            border-radius: 15px;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-item {
            padding: 15px;
            margin-bottom: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease;
        }

        .result-item:hover {
            transform: translateX(5px);
        }

        .result-label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 5px;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-value {
            font-size: 1.8em;
            color: #5a67d8;
            font-weight: 700;
        }

        .unit {
            font-size: 0.6em;
            color: #718096;
            font-weight: 400;
        }

        .fun-fact {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
            border-radius: 15px;
            border-left: 4px solid #f59e0b;
            color: #92400e;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .fun-fact:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(245, 158, 11, 0.2);
        }

        .fun-fact-emoji {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 2em;
            opacity: 0.5;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .fun-fact-title {
            font-weight: 700;
            font-size: 1.1em;
            margin-bottom: 8px;
            color: #b91c1c; 
        }

        .fun-fact-text {
            font-size: 1.05em;
            line-height: 1.4;
        }

        .fun-fact-refresh {
            display: inline-block;
            margin-top: 10px;
            padding: 6px 12px;
            background: rgba(245, 158, 11, 0.2);
            border-radius: 20px;
            font-size: 0.85em;
            color: #92400e;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .fun-fact-refresh:hover {
            background: rgba(245, 158, 11, 0.3);
            transform: scale(1.05);
        }

        .chart-container {
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            position: relative;
            height: 400px; 
        }

        .chart-title {
            text-align: center;
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: 600;
        }

        .formula-section {
            margin-top: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 15px;
            backdrop-filter: blur(5px);
        }

        .formula-section h2 {
            color: #5a67d8;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8em;
        }

        .formula-section h3 {
            color: #4a5568;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .formula-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            font-family: 'Courier New', monospace;
            text-align: center;
            font-size: 1.1em;
            color: #2d3748;
        }

        .stage-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden; 
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .stage-table th, .stage-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .stage-table th {
            background: #5a67d8;
            color: white;
            font-weight: 600;
        }

        .stage-table tr:last-child td {
            border-bottom: none;
        }

        .stage-table tr:hover {
            background: #f7fafc;
        }

        .modifier-list {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            list-style-position: inside; 
        }

        .modifier-list li {
            margin: 10px 0;
            padding-left: 0px; 
            position: relative;
        }
      
        .modifier-list > li:before { 
            content: "‚Ä¢";
            color: #5a67d8;
            font-weight: bold;
            position: absolute;
            left: -15px; 
        }
         .modifier-list ul {
            list-style: none;
            padding-left: 20px; 
            margin-top: 5px;
        }
        .modifier-list ul li:before { /* Style for bullets in nested lists */
            content: "-"; 
            color: #764ba2;
            position: absolute;
            left: -10px; 
        }


        .share-section {
            margin-top: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #f0f4f8 0%, #e2e8f0 100%);
            border-radius: 15px;
            text-align: center;
        }

        .share-title {
            font-size: 1.2em;
            color: #4a5568;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .share-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .share-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            color: white;
            font-size: 1em;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .share-btn-x {
            background: #000000;
        }

        .share-btn-x:hover {
            background: #1a1a1a;
        }

        .share-btn-bluesky {
            background: #00A8E8;
        }

        .share-btn-bluesky:hover {
            background: #0090c7;
        }

        .share-icon {
            width: 20px;
            height: 20px;
            fill: currentColor; 
        }

        .donate-section {
            margin-top: 25px;
            padding: 25px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(255, 165, 0, 0.3);
        }

        .donate-title {
            font-size: 1.4em;
            color: #333;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .donate-subtitle {
            font-size: 1em;
            color: #555;
            margin-bottom: 20px;
        }

        .donate-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 16px 32px;
            background: linear-gradient(135deg, #0057B7 0%, #0057B7 50%, #FFD700 50%, #FFD700 100%);
            background-size: 200% 100%;
            background-position: 0% 0%;
            color: white; 
            border-radius: 12px;
            text-decoration: none;
            font-weight: 700;
            font-size: 1.2em;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .donate-btn .lucide-heart { 
            stroke: white; 
        }

        .donate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            background-position: 100% 0%;
            color: #0057B7; 
        }
        .donate-btn:hover .lucide-heart {
            stroke: #0057B7; 
        }


        .donate-amount {
            font-size: 1.3em;
            font-weight: 800;
        }
        
        .language-selector-group {
            margin-bottom: 20px;
            text-align: right;
        }
        .language-selector-group label {
            margin-right: 8px;
            font-weight: normal;
            font-size: 0.9em;
            display: inline-block; 
        }
        .language-selector-group select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 0.9em;
            width: auto; 
        }


        @media (max-width: 480px) {
            .input-row {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2em;
            }
            .container {
                padding: 20px;
            }
            .language-selector-group {
                text-align: center; 
                margin-bottom: 15px;
            }
            .language-selector-group label {
                display: block; 
                margin-bottom: 5px;
            }
            .language-selector-group select {
                width: 100%; 
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 data-translate="mainHeading">PooPeelator</h1> 
        <div class="language-selector-group">
            <label for="languageSelector" data-translate="languageSelectorLabel">Language:</label>
            <select id="languageSelector">
                <option value="en">English</option>
                <option value="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
            </select>
        </div>

        <p class="subtitle" data-translate="subheading">Calculate your lifetime waste production!</p>
        
        <form id="calculatorForm">
            <div class="form-group">
                <label for="name" data-translate="labelName">Name</label>
                <input type="text" id="name" required data-translate-placeholder="placeholderName" placeholder="Enter your name">
            </div>
            
            <div class="form-group">
                <label for="age" data-translate="labelAge">Age (years)</label>
                <input type="number" id="age" min="0" max="120" required data-translate-placeholder="placeholderAge" placeholder="Enter your age">
            </div>
            
            <div class="form-group">
                <label for="gender" data-translate="labelGender">Gender</label>
                <select id="gender" required>
                    <option value="" data-translate="genderSelectDefault">Select gender</option>
                    <option value="male" data-translate="genderMale">Male</option>
                    <option value="female" data-translate="genderFemale">Female</option>
                </select>
            </div>
            
            <div class="input-row">
                <div class="form-group">
                    <label for="weight" data-translate="labelWeight">Weight (kg)</label>
                    <input type="number" id="weight" min="0" max="300" step="0.1" required data-translate-placeholder="placeholderWeight" placeholder="Weight in kg">
                </div>
                
                <div class="form-group">
                    <label for="height" data-translate="labelHeight">Height (cm)</label>
                    <input type="number" id="height" min="0" max="250" required data-translate-placeholder="placeholderHeight" placeholder="Height in cm">
                </div>
            </div>
            
            <button type="button" id="calculateBtn" data-translate="calculateButton">Calculate My Lifetime Output! üí©</button>
        </form>
        
        <div id="results" class="results">
            </div>
        
        <div class="formula-section">
            <h2 data-translate="formulaSectionTitle">üßÆ How We Calculate Your Output</h2>
            
            <div class="formula-box" data-translate="formulaBoxText">
                Total Output = Œ£ (Daily Rate √ó Gender Modifier √ó BMI Modifier √ó Days in Life Stage)
            </div>
            
            <h3 data-translate="baseRatesTitle">üìä Base Daily Production Rates by Life Stage</h3>
            <table class="stage-table">
                <thead>
                    <tr>
                        <th data-translate="tableHeaderLifeStage">Life Stage</th>
                        <th data-translate="tableHeaderAgeRange">Age Range</th>
                        <th data-translate="tableHeaderPoopPerDay">Poop (g/day)</th>
                        <th data-translate="tableHeaderPeePerDay">Pee (ml/day)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td data-translate="stageInfant">Infant</td>
                        <td>0-1 years</td>
                        <td>50g</td>
                        <td>400ml</td>
                    </tr>
                    <tr>
                        <td data-translate="stageToddler">Toddler</td>
                        <td>1-3 years</td>
                        <td>75g</td>
                        <td>600ml</td>
                    </tr>
                    <tr>
                        <td data-translate="stageChild">Child</td>
                        <td>3-12 years</td>
                        <td>100g</td>
                        <td>800ml</td>
                    </tr>
                    <tr>
                        <td data-translate="stageTeen">Teen</td>
                        <td>12-18 years</td>
                        <td>150g</td>
                        <td>1200ml</td>
                    </tr>
                    <tr>
                        <td data-translate="stageAdult">Adult</td>
                        <td>18-65 years</td>
                        <td>200g</td>
                        <td>1500ml</td>
                    </tr>
                    <tr>
                        <td data-translate="stageElderly">Elderly</td>
                        <td>65+ years</td>
                        <td>175g</td>
                        <td>1300ml</td>
                    </tr>
                </tbody>
            </table>
            
            <h3 data-translate="adjustmentModifiersTitle">üîß Adjustment Modifiers</h3>
            <ul class="modifier-list">
                <li> <strong data-translate="genderModifiersListTitleText">Gender Modifiers:</strong>
                    <ul style="list-style: none; margin-top: 10px;">
                        <li data-translate="genderModifierMaleText">üë® Male: Poop √ó1.1, Pee √ó1.05</li>
                        <li data-translate="genderModifierFemaleText">üë© Female: Poop √ó0.9, Pee √ó0.95</li>
                    </ul>
                </li>
                <li> <strong data-translate="bmiModifiersListTitleText">BMI Modifiers:</strong>
                    <ul style="list-style: none; margin-top: 10px;">
                        <li data-translate="bmiModifierUnderweight">Underweight (BMI &lt; 18.5): √ó0.85</li>
                        <li data-translate="bmiModifierNormal">Normal (BMI 18.5-25): √ó1.0</li>
                        <li data-translate="bmiModifierOverweight">Overweight (BMI 25-30): √ó1.15</li>
                        <li data-translate="bmiModifierObese">Obese (BMI &gt; 30): √ó1.3</li>
                    </ul>
                </li>
            </ul>
            
            <h3 data-translate="calculationStepsTitle">üìù Calculation Steps</h3>
            <ol class="modifier-list" style="list-style: decimal inside;">
                <li data-translate="calculationStep1">Calculate your BMI: Weight(kg) √∑ Height(m)¬≤</li>
                <li data-translate="calculationStep2">For each year of your life, determine the life stage</li>
                <li data-translate="calculationStep3">Apply the base daily rate for that stage</li>
                <li data-translate="calculationStep4">Multiply by gender and BMI modifiers</li>
                <li data-translate="calculationStep5">Multiply by 365.25 days (accounting for leap years)</li>
                <li data-translate="calculationStep6">Sum all years together for lifetime total</li>
            </ol>
            
            <div style="text-align: center; margin-top: 25px; color: #666; font-style: italic;" data-translate="formulaNote">
                Note: These calculations are based on average human waste production studies and provide estimates for entertainment purposes.
            </div>
        </div>
    </div>

    <script>
        // --- START TRANSLATIONS ---
        const translations = {
            en: {
                pageTitle: "PooPeelator - Lifetime Waste Calculator",
                mainHeading: "PooPeelator <span class=\"emoji\">üí©</span>",
                subheading: "Calculate your lifetime waste production!",
                languageSelectorLabel: "Language:",
                labelName: "Name",
                labelAge: "Age (years)",
                labelGender: "Gender",
                labelWeight: "Weight (kg)",
                labelHeight: "Height (cm)",
                genderSelectDefault: "Select gender",
                genderMale: "Male",
                genderFemale: "Female",
                placeholderName: "Enter your name",
                placeholderAge: "Enter your age",
                placeholderWeight: "Weight in kg",
                placeholderHeight: "Height in cm",
                calculateButton: "Calculate My Lifetime Output! <span class=\"emoji\">üí©</span>",
                resultsTitle: "{name}'s Lifetime Production ÔøΩ",
                totalPoop: "üí© Total Poop",
                totalPee: "üíß Total Pee",
                unitKg: "kg",
                unitLiters: "liters",
                funFactRefresh: "üîÑ Click for another fact!",
                formulaSectionTitle: "üßÆ How We Calculate Your Output",
                formulaBoxText: "Total Output = Œ£ (Daily Rate √ó Gender Modifier √ó BMI Modifier √ó Days in Life Stage)",
                baseRatesTitle: "üìä Base Daily Production Rates by Life Stage",
                tableHeaderLifeStage: "Life Stage",
                tableHeaderAgeRange: "Age Range",
                tableHeaderPoopPerDay: "Poop (g/day)",
                tableHeaderPeePerDay: "Pee (ml/day)",
                stageInfant: "Infant",
                stageToddler: "Toddler",
                stageChild: "Child",
                stageTeen: "Teen",
                stageAdult: "Adult",
                stageElderly: "Elderly",
                adjustmentModifiersTitle: "üîß Adjustment Modifiers",
                genderModifiersListTitleText: "Gender Modifiers:", // Plain text now
                genderModifierMaleText: "üë® Male: Poop √ó1.1, Pee √ó1.05",
                genderModifierFemaleText: "üë© Female: Poop √ó0.9, Pee √ó0.95",
                bmiModifiersListTitleText: "BMI Modifiers:", // Plain text now
                bmiModifierUnderweight: "Underweight (BMI &lt; 18.5): √ó0.85",
                bmiModifierNormal: "Normal (BMI 18.5-25): √ó1.0",
                bmiModifierOverweight: "Overweight (BMI 25-30): √ó1.15",
                bmiModifierObese: "Obese (BMI &gt; 30): √ó1.3",
                calculationStepsTitle: "üìù Calculation Steps",
                calculationStep1: "Calculate your BMI: Weight(kg) √∑ Height(m)¬≤",
                calculationStep2: "For each year of your life, determine the life stage",
                calculationStep3: "Apply the base daily rate for that stage",
                calculationStep4: "Multiply by gender and BMI modifiers",
                calculationStep5: "Multiply by 365.25 days (accounting for leap years)",
                calculationStep6: "Sum all years together for lifetime total",
                formulaNote: "Note: These calculations are based on average human waste production studies and provide estimates for entertainment purposes.",
                chartTitle: "Waste Accumulation Over Years",
                shareSectionTitle: "Share Your Results!",
                shareOnXButton: "Share on X",
                shareOnBlueskyButton: "Share on Bluesky",
                shareTextMessage: "I'm {name} and I've produced {poopKg}kg of poop and {peeLiters}L of pee in my lifetime! üí© Calculate yours at {url}",
                donateSectionTitle: "Support Ukraine! üá∫üá¶",
                donateSubtitle: "Consider donating the equivalent of your lifetime poop (in kg) as UAH to support Ukrainian defenders.",
                donateButtonText: "Donate <span class=\"donate-amount\">{amount} UAH</span> via savelife.in.ua",
                alertAllFields: "Please fill in all fields",
                funFacts: [ // Fun facts remain the same
                    { id: "toiletBowl", emoji: "üöΩ", title: "Toilet Bowl Champion!", text: "You've filled {value} toilet bowls to the brim! That's a whole bathroom showroom worth of displays!", value: (p,l,t) => Math.floor(p / 50) },
                    { id: "bathTime", emoji: "üõÅ", title: "Bath Time Bonanza!", text: "Your lifetime pee could fill {value} standard bathtubs! Hope you like bubble baths!", value: (p,l,t) => Math.floor(l / 200) },
                    { id: "bowlingBall", emoji: "üé≥", title: "Strike! Bowling Ball Brigade!", text: "Your poop weighs as much as {value} bowling balls! That's an entire bowling alley's worth!", value: (p,l,t) => Math.floor(p / 6) },
                    { id: "riceBags", emoji: "üçö", title: "Rice Rice Baby!", text: "That's heavier than {value} bags of rice! You could feed a small village... well, not with this!", value: (p,l,t) => Math.floor(p / 0.5) },
                    { id: "aquarium", emoji: "üê†", title: "Aquarium Adventure!", text: "Your pee could fill {value} large aquarium tanks! The fish would not be happy about this arrangement!", value: (p,l,t) => Math.floor(l / 2) },
                    { id: "poopTower", emoji: "üèóÔ∏è", title: "Poop Tower Engineering!", text: "If stacked (ew!), your poop would reach {value} meters high! That's a tall tower!", value: (p,l,t) => Math.floor(p / 2) },
                    { id: "gardenGold", emoji: "üåª", title: "Garden Gold!", text: "Your pee could water a garden for {value} days! Your flowers would be... well-nourished!", value: (p,l,t) => Math.floor(l / 10) },
                    { id: "carTires", emoji: "üöó", title: "Tire-d of These Facts?", text: "Your total waste weighs more than {value} car tires! That's a lot of rubber to burn!", value: (p,l,t) => Math.floor(t / 15) },
                    { id: "compost", emoji: "üå±", title: "Compost King/Queen!", text: "You could make {value} kg of premium compost! Your tomatoes would be HUGE!", value: (p,l,t) => Math.floor(p / 0.5) },
                    { id: "sodaCans", emoji: "ü•§", title: "Soda Stream Supreme!", text: "That's {value} cans of soda worth of pee! (Please don't carbonate it)", value: (p,l,t) => Math.floor(l / 0.33) },
                    { id: "babyElephants", emoji: "üêò", title: "Elephant in the Room!", text: "Your lifetime poop weighs as much as {value} baby elephants! Dumbo would be impressed!", value: (p,l,t) => (p / 200).toFixed(1) },
                    { id: "olympicPool", emoji: "üèä", title: "Olympic Pee Pool!", text: "You've produced {value}% of an Olympic swimming pool's worth of pee!", value: (p,l,t) => (l / 2500000 * 100).toFixed(3) },
                    { id: "easterIsland", emoji: "üóø", title: "Historical Achievement!", text: "Your waste weighs {value} tons! That's heavier than some Easter Island statues!", value: (p,l,t) => (t / 1000).toFixed(1) },
                    { id: "pizzas", emoji: "üçï", title: "Pizza Party Pooper!", text: "Your poop weighs as much as {value} large pizzas! (Different kind of delivery though)", value: (p,l,t) => Math.floor(p / 0.3) },
                    { id: "textbooks", emoji: "üìö", title: "Library of Loo Literature!", text: "Your waste weighs as much as {value} thick textbooks! That's a whole semester's worth!", value: (p,l,t) => Math.floor(t / 0.5) }
                ]
            },
            uk: {
                pageTitle: "–ö–∞–∫—É–ª—è—Ç–æ—Ä - –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –í—ñ–¥—Ö–æ–¥—ñ–≤ –ñ–∏—Ç—Ç—î–¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ",
                mainHeading: "–ö–∞–∫—É–ª—è—Ç–æ—Ä <span class=\"emoji\">üí©</span>",
                subheading: "–†–æ–∑—Ä–∞—Ö—É–π—Ç–µ –æ–±—Å—è–≥ –≤—ñ–¥—Ö–æ–¥—ñ–≤ –∑–∞ –≤—Å–µ –∂–∏—Ç—Ç—è!",
                languageSelectorLabel: "–ú–æ–≤–∞:",
                labelName: "–Ü–º'—è",
                labelAge: "–í—ñ–∫ (—Ä–æ–∫—ñ–≤)",
                labelGender: "–°—Ç–∞—Ç—å",
                labelWeight: "–í–∞–≥–∞ (–∫–≥)",
                labelHeight: "–ó—Ä—ñ—Å—Ç (—Å–º)",
                genderSelectDefault: "–û–±–µ—Ä—ñ—Ç—å —Å—Ç–∞—Ç—å",
                genderMale: "–ß–æ–ª–æ–≤—ñ–∫",
                genderFemale: "–ñ—ñ–Ω–∫–∞",
                placeholderName: "–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ —ñ–º'—è",
                placeholderAge: "–í–≤–µ–¥—ñ—Ç—å –≤–∞—à –≤—ñ–∫",
                placeholderWeight: "–í–∞–≥–∞ –≤ –∫–≥",
                placeholderHeight: "–ó—Ä—ñ—Å—Ç –≤ —Å–º",
                calculateButton: "–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –ú—ñ–π –û–±—Å—è–≥! <span class=\"emoji\">üí©</span>",
                resultsTitle: "–û–±—Å—è–≥ {name} –∑–∞ –∂–∏—Ç—Ç—è üìä",
                totalPoop: "üí© –ó–∞–≥–∞–ª–æ–º –∫–∞–ª—É",
                totalPee: "üíß –ó–∞–≥–∞–ª–æ–º —Å–µ—á—ñ",
                unitKg: "–∫–≥",
                unitLiters: "–ª",
                funFactRefresh: "üîÑ –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è —ñ–Ω—à–æ–≥–æ —Ñ–∞–∫—Ç—É!",
                formulaSectionTitle: "üßÆ –Ø–∫ –ú–∏ –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ –í–∞—à –û–±—Å—è–≥",
                formulaBoxText: "–ó–∞–≥–∞–ª—å–Ω–∏–π –û–±—Å—è–≥ = Œ£ (–î–µ–Ω–Ω–∞ –ù–æ—Ä–º–∞ √ó –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –°—Ç–∞—Ç—ñ √ó –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –Ü–ú–¢ √ó –ö—ñ–ª—å–∫—ñ—Å—Ç—å –î–Ω—ñ–≤ –Ω–∞ –ï—Ç–∞–ø—ñ –ñ–∏—Ç—Ç—è)",
                baseRatesTitle: "üìä –ë–∞–∑–æ–≤—ñ –î–µ–Ω–Ω—ñ –ù–æ—Ä–º–∏ –í–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–∞ –∑–∞ –ï—Ç–∞–ø–∞–º–∏ –ñ–∏—Ç—Ç—è",
                tableHeaderLifeStage: "–ï—Ç–∞–ø –ñ–∏—Ç—Ç—è",
                tableHeaderAgeRange: "–í—ñ–∫–æ–≤–∏–π –î—ñ–∞–ø–∞–∑–æ–Ω",
                tableHeaderPoopPerDay: "–ö–∞–∫—É–ª—ñ (–≥/–¥–µ–Ω—å)",
                tableHeaderPeePerDay: "–°–µ—á–∞ (–º–ª/–¥–µ–Ω—å)",
                stageInfant: "–ù–µ–º–æ–≤–ª—è",
                stageToddler: "–ú–∞–ª—é–∫",
                stageChild: "–î–∏—Ç–∏–Ω–∞",
                stageTeen: "–ü—ñ–¥–ª—ñ—Ç–æ–∫",
                stageAdult: "–î–æ—Ä–æ—Å–ª–∏–π",
                stageElderly: "–õ—ñ—Ç–Ω—è –ª—é–¥–∏–Ω–∞",
                adjustmentModifiersTitle: "üîß –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –ö–æ—Ä–∏–≥—É–≤–∞–Ω–Ω—è",
                genderModifiersListTitleText: "–ú–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –°—Ç–∞—Ç—ñ:", // Plain text now
                genderModifierMaleText: "üë® –ß–æ–ª–æ–≤—ñ–∫: –ö–∞–ª √ó1.1, –°–µ—á–∞ √ó1.05",
                genderModifierFemaleText: "üë© –ñ—ñ–Ω–∫–∞: –ö–∞–ª √ó0.9, –°–µ—á–∞ √ó0.95",
                bmiModifiersListTitleText: "–ú–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –Ü–ú–¢:", // Plain text now
                bmiModifierUnderweight: "–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—è –≤–∞–≥–∞ (–Ü–ú–¢ < 18.5): √ó0.85",
                bmiModifierNormal: "–ù–æ—Ä–º–∞ (–Ü–ú–¢ 18.5-25): √ó1.0",
                bmiModifierOverweight: "–ù–∞–¥–º—ñ—Ä–Ω–∞ –≤–∞–≥–∞ (–Ü–ú–¢ 25-30): √ó1.15",
                bmiModifierObese: "–û–∂–∏—Ä—ñ–Ω–Ω—è (–Ü–ú–¢ > 30): √ó1.3",
                calculationStepsTitle: "üìù –ï—Ç–∞–ø–∏ –†–æ–∑—Ä–∞—Ö—É–Ω–∫—É",
                calculationStep1: "–†–æ–∑—Ä–∞—Ö—É–π—Ç–µ –≤–∞—à –Ü–ú–¢: –í–∞–≥–∞(–∫–≥) √∑ –ó—Ä—ñ—Å—Ç(–º)¬≤",
                calculationStep2: "–î–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ä–æ–∫—É –≤–∞—à–æ–≥–æ –∂–∏—Ç—Ç—è –≤–∏–∑–Ω–∞—á—Ç–µ –µ—Ç–∞–ø –∂–∏—Ç—Ç—è",
                calculationStep3: "–ó–∞—Å—Ç–æ—Å—É–π—Ç–µ –±–∞–∑–æ–≤—É –¥–µ–Ω–Ω—É –Ω–æ—Ä–º—É –¥–ª—è —Ü—å–æ–≥–æ –µ—Ç–∞–ø—É",
                calculationStep4: "–ü–æ–º–Ω–æ–∂—Ç–µ –Ω–∞ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ —Å—Ç–∞—Ç—ñ —Ç–∞ –Ü–ú–¢",
                calculationStep5: "–ü–æ–º–Ω–æ–∂—Ç–µ –Ω–∞ 365.25 –¥–Ω—ñ–≤ (–≤—Ä–∞—Ö–æ–≤—É—é—á–∏ –≤–∏—Å–æ–∫–æ—Å–Ω—ñ —Ä–æ–∫–∏)",
                calculationStep6: "–ü—ñ–¥—Å—É–º—É–π—Ç–µ –≤—Å—ñ —Ä–æ–∫–∏ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ –æ–±—Å—è–≥—É –∑–∞ –∂–∏—Ç—Ç—è",
                formulaNote: "–ü—Ä–∏–º—ñ—Ç–∫–∞: –¶—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ –±–∞–∑—É—é—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–µ–¥–Ω—å–æ—Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–∏—Ö –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è—Ö –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–∞ –≤—ñ–¥—Ö–æ–¥—ñ–≤ –ª—é–¥–∏–Ω–æ—é —Ç–∞ –Ω–∞–¥–∞—é—Ç—å –ø—Ä–∏–±–ª–∏–∑–Ω—ñ –æ—Ü—ñ–Ω–∫–∏ –¥–ª—è —Ä–æ–∑–≤–∞–∂–∞–ª—å–Ω–∏—Ö —Ü—ñ–ª–µ–π.",
                chartTitle: "–ù–∞–∫–æ–ø–∏—á–µ–Ω–Ω—è –í—ñ–¥—Ö–æ–¥—ñ–≤ –ü—Ä–æ—Ç—è–≥–æ–º –†–æ–∫—ñ–≤",
                shareSectionTitle: "–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è –†–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏!",
                shareOnXButton: "–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –≤ X",
                shareOnBlueskyButton: "–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –≤ Bluesky",
                shareTextMessage: "–Ø, {name}, –∑–∞ —Å–≤–æ—î –∂–∏—Ç—Ç—è –≤–∏—Ä–æ–±–∏–≤(–ª–∞) {poopKg}–∫–≥ –∫–∞–ª—É —Ç–∞ {peeLiters}–ª —Å–µ—á—ñ! üí© –†–æ–∑—Ä–∞—Ö—É–π—Ç–µ —Å–≤—ñ–π –æ–±—Å—è–≥ –Ω–∞ {url}",
                donateSectionTitle: "–ü—ñ–¥—Ç—Ä–∏–º–∞–π –£–∫—Ä–∞—ó–Ω—É! üá∫üá¶",
                donateSubtitle: "–ü–æ–¥—É–º–∞–π—Ç–µ –ø—Ä–æ —Ç–µ, —â–æ–± –ø–æ–∂–µ—Ä—Ç–≤—É–≤–∞—Ç–∏ –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç –≤–∞—à–∏—Ö –∫–∞–∫—É–ª—ñ–≤ –∑–∞ –≤—Å–µ –∂–∏—Ç—Ç—è (–≤ –∫–≥) —É –≥—Ä–∏–≤–Ω—è—Ö –Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫—É —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏—Ö –∑–∞—Ö–∏—Å–Ω–∏–∫—ñ–≤.",
                donateButtonText: "–ü–æ–∂–µ—Ä—Ç–≤—É–≤–∞—Ç–∏ <span class=\"donate-amount\">{amount} –≥—Ä–Ω</span> —á–µ—Ä–µ–∑ savelife.in.ua",
                alertAllFields: "–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –ø–æ–ª—è",
                funFacts: [ // Fun facts remain the same
                    { id: "toiletBowl", emoji: "üöΩ", title: "–ß–µ–º–ø—ñ–æ–Ω –£–Ω—ñ—Ç–∞–∑—É!", text: "–í–∏ –∑–∞–ø–æ–≤–Ω–∏–ª–∏ {value} —É–Ω—ñ—Ç–∞–∑—ñ–≤ –¥–æ –∫—Ä–∞—ó–≤! –¶—å–æ–≥–æ –≤–∏—Å—Ç–∞—á–∏—Ç—å –Ω–∞ —Ü—ñ–ª–∏–π –≤–∏—Å—Ç–∞–≤–∫–æ–≤–∏–π –∑–∞–ª —Å–∞–Ω—Ç–µ—Ö–Ω—ñ–∫–∏!", value: (p,l,t) => Math.floor(p / 50) },
                    { id: "bathTime", emoji: "üõÅ", title: "–í–∞–Ω–Ω–∞ –í–µ—Å–µ–ª–æ—â—ñ–≤!", text: "–í–∞—à–∞ —Å–µ—á–∞ –∑–∞ –≤—Å–µ –∂–∏—Ç—Ç—è –º–æ–≥–ª–∞ –± –∑–∞–ø–æ–≤–Ω–∏—Ç–∏ {value} —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –≤–∞–Ω–Ω! –°–ø–æ–¥—ñ–≤–∞—î–º–æ—Å—å, –≤–∏ –ª—é–±–∏—Ç–µ –ø—ñ–Ω–Ω—ñ –≤–∞–Ω–Ω–∏!", value: (p,l,t) => Math.floor(l / 200) },
                    { id: "bowlingBall", emoji: "üé≥", title: "–°—Ç—Ä–∞–π–∫! –ë—Ä–∏–≥–∞–¥–∞ –ö—É–ª—å –¥–ª—è –ë–æ—É–ª—ñ–Ω–≥—É!", text: "–í–∞—à –∫–∞–ª –≤–∞–∂–∏—Ç—å —Å—Ç—ñ–ª—å–∫–∏ –∂, —Å–∫—ñ–ª—å–∫–∏ {value} –∫—É–ª—å –¥–ª—è –±–æ—É–ª—ñ–Ω–≥—É! –¶—å–æ–≥–æ –≤–∏—Å—Ç–∞—á–∏—Ç—å –Ω–∞ —Ü—ñ–ª–∏–π –±–æ—É–ª—ñ–Ω–≥-–∫–ª—É–±!", value: (p,l,t) => Math.floor(p / 6) },
                    { id: "riceBags", emoji: "üçö", title: "–†–∏—Å, –†–∏—Å, –î–∏—Ç–∏–Ω–∫–æ!", text: "–¶–µ –≤–∞–∂—á–µ, –Ω—ñ–∂ {value} –º—ñ—à–∫—ñ–≤ —Ä–∏—Å—É! –í–∏ –º–æ–≥–ª–∏ –± –Ω–∞–≥–æ–¥—É–≤–∞—Ç–∏ –Ω–µ–≤–µ–ª–∏–∫–µ —Å–µ–ª–æ... –Ω—É, –Ω–µ —Ü–∏–º!", value: (p,l,t) => Math.floor(p / 0.5) },
                    { id: "aquarium", emoji: "üê†", title: "–ê–∫–≤–∞—Ä—ñ—É–º–Ω–∞ –ü—Ä–∏–≥–æ–¥–∞!", text: "–í–∞—à–∞ —Å–µ—á–∞ –º–æ–≥–ª–∞ –± –∑–∞–ø–æ–≤–Ω–∏—Ç–∏ {value} –≤–µ–ª–∏–∫–∏—Ö –∞–∫–≤–∞—Ä—ñ—É–º—ñ–≤! –†–∏–±–∫–∏ –Ω–µ –±—É–ª–∏ –± –∑–∞–¥–æ–≤–æ–ª–µ–Ω—ñ —Ç–∞–∫–∏–º —Å—É—Å—ñ–¥—Å—Ç–≤–æ–º!", value: (p,l,t) => Math.floor(l / 2) },
                    { id: "poopTower", emoji: "üèóÔ∏è", title: "–Ü–Ω–∂–µ–Ω–µ—Ä—ñ—è –í–µ–∂—ñ –∑ –ö–∞–ª—É!", text: "–Ø–∫—â–æ —Å–∫–ª–∞—Å—Ç–∏ (—Ñ—É!), –≤–∞—à –∫–∞–ª —Å—è–≥–Ω—É–≤ –±–∏ {value} –º–µ—Ç—Ä—ñ–≤ —É –≤–∏—Å–æ—Ç—É! –£—è–≤—ñ—Ç—å —Å–æ–±—ñ —Ü—é –≤–µ–∂—É!", value: (p,l,t) => Math.floor(p / 2) },
                    { id: "gardenGold", emoji: "üåª", title: "–ó–æ–ª–æ—Ç–æ –¥–ª—è –°–∞–¥—É!", text: "–í–∞—à–æ—é —Å–µ—á–µ—é –º–æ–∂–Ω–∞ –±—É–ª–æ –± –ø–æ–ª–∏–≤–∞—Ç–∏ —Å–∞–¥ –ø—Ä–æ—Ç—è–≥–æ–º {value} –¥–Ω—ñ–≤! –í–∞—à—ñ –∫–≤—ñ—Ç–∏ –±—É–ª–∏ –±... –¥–æ–±—Ä–µ –ø—ñ–¥–∂–∏–≤–ª–µ–Ω—ñ!", value: (p,l,t) => Math.floor(l / 10) },
                    { id: "carTires", emoji: "üöó", title: "–í—Ç–æ–º–∏–ª–∏—Å—è –≤—ñ–¥ –¶–∏—Ö –§–∞–∫—Ç—ñ–≤?", text: "–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞–≥–∞ –≤–∞—à–∏—Ö –≤—ñ–¥—Ö–æ–¥—ñ–≤ –±—ñ–ª—å—à–∞, –Ω—ñ–∂ {value} –∞–≤—Ç–æ–º–æ–±—ñ–ª—å–Ω–∏—Ö —à–∏–Ω! –¶–µ –±–∞–≥–∞—Ç–æ –≥—É–º–∏ –¥–ª—è —Å–ø–∞–ª—é–≤–∞–Ω–Ω—è!", value: (p,l,t) => Math.floor(t / 15) },
                    { id: "compost", emoji: "üå±", title: "–ö–æ—Ä–æ–ª—å/–ö–æ—Ä–æ–ª–µ–≤–∞ –ö–æ–º–ø–æ—Å—Ç—É!", text: "–í–∏ –º–æ–≥–ª–∏ –± –∑—Ä–æ–±–∏—Ç–∏ {value} –∫–≥ –ø—Ä–µ–º—ñ–∞–ª—å–Ω–æ–≥–æ –∫–æ–º–ø–æ—Å—Ç—É! –í–∞—à—ñ –ø–æ–º—ñ–¥–æ—Ä–∏ –±—É–ª–∏ –± –í–ï–õ–ò–ß–ï–ó–ù–ò–ú–ò!", value: (p,l,t) => Math.floor(p / 0.5) },
                    { id: "sodaCans", emoji: "ü•§", title: "–°–æ–¥–æ–≤–∏–π –°—Ç—Ä—ñ–º –°—É–ø–µ—Ä!", text: "–¶–µ {value} –±–∞–Ω–æ–∫ –≥–∞–∑–æ–≤–∞–Ω–æ—ó –≤–æ–¥–∏ —Å–µ—á—ñ! (–ë—É–¥—å –ª–∞—Å–∫–∞, –Ω–µ –≥–∞–∑—É–π—Ç–µ —ó—ó)", value: (p,l,t) => Math.floor(l / 0.33) },
                    { id: "babyElephants", emoji: "üêò", title: "–°–ª–æ–Ω —É –ö—ñ–º–Ω–∞—Ç—ñ!", text: "–í–∞—à –∫–∞–ª –∑–∞ –≤—Å–µ –∂–∏—Ç—Ç—è –≤–∞–∂–∏—Ç—å —Å—Ç—ñ–ª—å–∫–∏ –∂, —Å–∫—ñ–ª—å–∫–∏ {value} —Å–ª–æ–Ω–µ–Ω—è—Ç! –î–∞–º–±–æ –±—É–≤ –±–∏ –≤—Ä–∞–∂–µ–Ω–∏–π!", value: (p,l,t) => (p / 200).toFixed(1) },
                    { id: "olympicPool", emoji: "üèä", title: "–û–ª—ñ–º–ø—ñ–π—Å—å–∫–∏–π –ë–∞—Å–µ–π–Ω –°–µ—á—ñ!", text: "–í–∏ –≤–∏—Ä–æ–±–∏–ª–∏ {value}% –æ–±'—î–º—É –æ–ª—ñ–º–ø—ñ–π—Å—å–∫–æ–≥–æ –±–∞—Å–µ–π–Ω—É —Å–µ—á—ñ!", value: (p,l,t) => (l / 2500000 * 100).toFixed(3) },
                    { id: "easterIsland", emoji: "üóø", title: "–Ü—Å—Ç–æ—Ä–∏—á–Ω–µ –î–æ—Å—è–≥–Ω–µ–Ω–Ω—è!", text: "–í–∞—à—ñ –≤—ñ–¥—Ö–æ–¥–∏ –≤–∞–∂–∞—Ç—å {value} —Ç–æ–Ω–Ω! –¶–µ –≤–∞–∂—á–µ, –Ω—ñ–∂ –¥–µ—è–∫—ñ —Å—Ç–∞—Ç—É—ó –∑ –æ—Å—Ç—Ä–æ–≤–∞ –ü–∞—Å—Ö–∏!", value: (p,l,t) => (t / 1000).toFixed(1) },
                    { id: "pizzas", emoji: "üçï", title: "–ü—ñ—Ü–∞-–ü–∞—Ç—ñ –ö–∞–∫—É–Ω!", text: "–í–∞—à –∫–∞–ª –≤–∞–∂–∏—Ç—å —Å—Ç—ñ–ª—å–∫–∏ –∂, —Å–∫—ñ–ª—å–∫–∏ {value} –≤–µ–ª–∏–∫–∏—Ö –ø—ñ—Ü! (–•–æ—á–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ —ñ–Ω—à–æ–≥–æ —Ä–æ–¥—É)", value: (p,l,t) => Math.floor(p / 0.3) },
                    { id: "textbooks", emoji: "üìö", title: "–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –¢—É–∞–ª–µ—Ç–Ω–æ—ó –õ—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∏!", text: "–í–∞—à—ñ –≤—ñ–¥—Ö–æ–¥–∏ –≤–∞–∂–∞—Ç—å —Å—Ç—ñ–ª—å–∫–∏ –∂, —Å–∫—ñ–ª—å–∫–∏ {value} —Ç–æ–≤—Å—Ç–∏—Ö –ø—ñ–¥—Ä—É—á–Ω–∏–∫—ñ–≤! –¶—å–æ–≥–æ –≤–∏—Å—Ç–∞—á–∏—Ç—å –Ω–∞ —Ü—ñ–ª–∏–π —Å–µ–º–µ—Å—Ç—Ä!", value: (p,l,t) => Math.floor(t / 0.5) }
                ]
            }
        };
        // --- END TRANSLATIONS ---

        let currentLang = 'en'; // Default language
        window.lastCalculationData = null; 
        window.currentPoopKg = 0; 
        window.currentPeeLiters = 0;

        // --- I18N Core Functions ---
        function setLanguage(lang) {
            if (translations[lang]) {
                currentLang = lang;
                localStorage.setItem('poopeelatorLang', lang);
                applyTranslations(lang);
            }
        }

        function applyTranslations(lang) {
            if (!translations[lang]) return;

            document.documentElement.lang = lang;
            
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.dataset.translate;
                if (translations[lang][key] !== undefined) {
                    el.innerHTML = translations[lang][key];
                }
            });

            document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                const key = el.dataset.translatePlaceholder;
                if (translations[lang][key] !== undefined) {
                    el.placeholder = translations[lang][key];
                }
            });
            
            const genderSelect = document.getElementById('gender');
            if (genderSelect) {
                if (genderSelect.options[0]) genderSelect.options[0].textContent = translations[lang].genderSelectDefault;
                if (genderSelect.options[1]) genderSelect.options[1].textContent = translations[lang].genderMale;
                if (genderSelect.options[2]) genderSelect.options[2].textContent = translations[lang].genderFemale;
            }

            const resultsDiv = document.getElementById('results');
            if (resultsDiv.style.display !== 'none' && window.lastCalculationData) {
                const { name, results, yearlyData } = window.lastCalculationData;
                displayResultsDOM(name, results, yearlyData, lang); 
            }
        }

        // --- Calculator Logic ---
        const WASTE_RATES_CALC = {
            poop: { infant: 0.050, toddler: 0.075, child: 0.100, teen: 0.150, adult: 0.200, elderly: 0.175 },
            pee: { infant: 0.400, toddler: 0.600, child: 0.800, teen: 1.200, adult: 1.500, elderly: 1.300 }
        };
        const GENDER_MODIFIERS_CALC = {
            male: { poop: 1.1, pee: 1.05 },
            female: { poop: 0.9, pee: 0.95 }
        };
        function getBMIModifier_CALC(bmi) {
            if (bmi < 18.5) return 0.85; if (bmi < 25) return 1.0; if (bmi < 30) return 1.15; return 1.3;
        }
        function calculateBMI_CALC(weight, height) {
            const heightInMeters = height / 100; return weight / (heightInMeters * heightInMeters);
        }
        function formatNumber(num) {
            return num.toLocaleString(currentLang === 'uk' ? 'uk-UA' : 'en-US', { maximumFractionDigits: 1 });
        }
        function calculateLifetimeWaste_CALC(age, gender, weight, height) {
            const bmi = calculateBMI_CALC(weight, height);
            const bmiModifier = getBMIModifier_CALC(bmi);
            const genderModifier = GENDER_MODIFIERS_CALC[gender];
            let totalPoop = 0; let totalPee = 0;
            const stages = [
                { name: 'infant', start: 0, end: 1 }, { name: 'toddler', start: 1, end: 3 },
                { name: 'child', start: 3, end: 12 }, { name: 'teen', start: 12, end: 18 },
                { name: 'adult', start: 18, end: 65 }, { name: 'elderly', start: 65, end: age }
            ];
            stages.forEach(stage => {
                if (age > stage.start) {
                    const yearsInStage = Math.min(age, stage.end) - stage.start;
                     if (yearsInStage <= 0) return;


                    const daysInStage = yearsInStage * 365.25;
                    const poopRate = WASTE_RATES_CALC.poop[stage.name] * genderModifier.poop * bmiModifier;
                    const peeRate = WASTE_RATES_CALC.pee[stage.name] * genderModifier.pee * bmiModifier;
                    totalPoop += poopRate * daysInStage; totalPee += peeRate * daysInStage;
                }
            });
            return { poop: totalPoop, pee: totalPee };
        }

        function calculateLifetimeWasteByYear_CALC(age, gender, weight, height) {
            const bmi = calculateBMI_CALC(weight, height);
            const bmiModifier = getBMIModifier_CALC(bmi);
            const genderModifier = GENDER_MODIFIERS_CALC[gender];
            const yearlyData = []; let cumulativePoop = 0; let cumulativePee = 0;
            
            for (let year = 0; year < age; year++) { // Iterate up to, but not including, the final age for full years
                let currentAgeAtYearEnd = year + 1;
                let stage;
                if (currentAgeAtYearEnd <= 1) stage = 'infant';
                else if (currentAgeAtYearEnd <= 3) stage = 'toddler';
                else if (currentAgeAtYearEnd <= 12) stage = 'child';
                else if (currentAgeAtYearEnd <= 18) stage = 'teen';
                else if (currentAgeAtYearEnd <= 65) stage = 'adult';
                else stage = 'elderly';
                
                const dailyPoop = WASTE_RATES_CALC.poop[stage] * genderModifier.poop * bmiModifier;
                const dailyPee = WASTE_RATES_CALC.pee[stage] * genderModifier.pee * bmiModifier;
                
                cumulativePoop += dailyPoop * 365.25;
                cumulativePee += dailyPee * 365.25;
                
                yearlyData.push({ year: currentAgeAtYearEnd, poop: cumulativePoop, pee: cumulativePee, total: cumulativePoop + cumulativePee });
            }

            // Handle partial last year if age is not an integer
            if (age % 1 !== 0) {
                let stage;
                if (age <= 1) stage = 'infant';
                else if (age <= 3) stage = 'toddler';
                else if (age <= 12) stage = 'child';
                else if (age <= 18) stage = 'teen';
                else if (age <= 65) stage = 'adult';
                else stage = 'elderly';

                const dailyPoop = WASTE_RATES_CALC.poop[stage] * genderModifier.poop * bmiModifier;
                const dailyPee = WASTE_RATES_CALC.pee[stage] * genderModifier.pee * bmiModifier;
                const fractionOfYear = age % 1;

                cumulativePoop += dailyPoop * (fractionOfYear * 365.25);
                cumulativePee += dailyPee * (fractionOfYear * 365.25);
                 // Add data point for the exact age
                if (!yearlyData.find(d => d.year === age) && fractionOfYear > 0) {
                     yearlyData.push({ year: parseFloat(age.toFixed(2)), poop: cumulativePoop, pee: cumulativePee, total: cumulativePoop + cumulativePee });
                }
            }
             // Ensure data points are sorted by year if partial year handling adds an out-of-order point (though logic above tries to avoid it)
            yearlyData.sort((a,b) => a.year - b.year);


            // Ensure there's a data point for year 0 if age is very small (e.g. 0.5)
            if (age > 0 && (yearlyData.length === 0 || yearlyData[0].year !== 0)) {
                let initialStage = age <=1 ? 'infant' : (age <=3 ? 'toddler' : 'child'); // Simplified for brevity
                 const initialDailyPoop = WASTE_RATES_CALC.poop[initialStage] * genderModifier.poop * bmiModifier;
                 const initialDailyPee = WASTE_RATES_CALC.pee[initialStage] * genderModifier.pee * bmiModifier;
                let initialPoop = 0;
                let initialPee = 0;
                if (age < 1) { // Only calculate if age is less than 1 for year 0
                    initialPoop = initialDailyPoop * (age * 365.25);
                    initialPee = initialDailyPee * (age * 365.25);
                }
                 // Add a (0,0,0) point if it doesn't exist and age > 0, or the specific calculation for age < 1
                if (!yearlyData.find(d => d.year === 0)) {
                    if (age < 1) {
                        yearlyData.unshift({ year: 0, poop: 0, pee: 0, total: 0 }); // Start from 0
                        // The actual value at age (e.g. 0.5) will be added by the partial year logic
                    } else {
                         yearlyData.unshift({ year: 0, poop: 0, pee: 0, total: 0 });
                    }
                }
            }


            return yearlyData;
        }


        // --- Fun Fact Logic (i18n aware) ---
        function getRandomFunFact(poopKg, peeLiters, lang) {
            const totalKg = poopKg + peeLiters; 
            const langFactTemplates = translations[lang].funFacts;
            if (!langFactTemplates || langFactTemplates.length === 0) {
                return { emoji: "ü§î", title: "Hmm...", text: "No fun facts available for this language." };
            }
            const randomFactTemplate = langFactTemplates[Math.floor(Math.random() * langFactTemplates.length)];
            const dynamicValue = randomFactTemplate.value(poopKg, peeLiters, totalKg);
            const processedText = randomFactTemplate.text.replace('{value}', dynamicValue);
            return { emoji: randomFactTemplate.emoji, title: randomFactTemplate.title, text: processedText };
        }

        function displayFunFactHTML(poopKg, peeLiters, lang) {
            window.currentPoopKg = poopKg; 
            window.currentPeeLiters = peeLiters;
            const fact = getRandomFunFact(poopKg, peeLiters, lang);
            return `
                <div class="fun-fact" onclick="triggerUpdateFunFact()">
                    <span class="fun-fact-emoji">${fact.emoji}</span>
                    <div class="fun-fact-title">${fact.title}</div>
                    <div class="fun-fact-text">${fact.text}</div>
                    <div class="fun-fact-refresh" data-translate="funFactRefresh">${translations[lang].funFactRefresh}</div>
                </div>`;
        }
        
        function triggerUpdateFunFact() {
            if (typeof window.currentPoopKg !== 'undefined' && typeof window.currentPeeLiters !== 'undefined') {
                 updateFunFactDOM(window.currentPoopKg, window.currentPeeLiters);
            }
        }

        function updateFunFactDOM(poopKg, peeLiters) {
            const funFactElement = document.querySelector('.fun-fact');
            if (funFactElement) {
                const newFact = getRandomFunFact(poopKg, peeLiters, currentLang);
                funFactElement.innerHTML = `
                    <span class="fun-fact-emoji">${newFact.emoji}</span>
                    <div class="fun-fact-title">${newFact.title}</div>
                    <div class="fun-fact-text">${newFact.text}</div>
                    <div class="fun-fact-refresh" data-translate="funFactRefresh">${translations[currentLang].funFactRefresh}</div>`;
                funFactElement.style.transform = 'scale(0.95)';
                setTimeout(() => { funFactElement.style.transform = 'scale(1)'; }, 100);
            }
        }

        // --- Chart and Results Display (i18n aware) ---
        let myChart = null;

        function displayResultsDOM(name, resultsData, yearlyData, lang) {
            const resultsDiv = document.getElementById('results');
            const uahAmount = Math.round(resultsData.poop);

            resultsDiv.innerHTML = `
                <h2 style="text-align: center; color: #5a67d8; margin-bottom: 20px;">
                    ${translations[lang].resultsTitle.replace('{name}', name)}
                </h2>
                <div class="result-item">
                    <div class="result-label">${translations[lang].totalPoop}</div>
                    <div class="result-value">${formatNumber(resultsData.poop)} <span class="unit">${translations[lang].unitKg}</span></div>
                </div>
                <div class="result-item">
                    <div class="result-label">${translations[lang].totalPee}</div>
                    <div class="result-value">${formatNumber(resultsData.pee)} <span class="unit">${translations[lang].unitLiters}</span></div>
                </div>
                ${displayFunFactHTML(resultsData.poop, resultsData.pee, lang)}
                <div class="chart-container">
                    <div class="chart-title" data-translate="chartTitle">${translations[lang].chartTitle}</div>
                    <canvas id="wasteChart"></canvas>
                </div>
                <div class="share-section">
                    <h3 class="share-title" data-translate="shareSectionTitle">${translations[lang].shareSectionTitle}</h3>
                    <div class="share-buttons">
                        <a href="#" class="share-btn share-btn-x" id="shareXBtn">
                            <svg class="share-icon" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></svg>
                            <span data-translate="shareOnXButton">${translations[lang].shareOnXButton}</span>
                        </a>
                        <a href="#" class="share-btn share-btn-bluesky" id="shareBlueskyBtn">
                             <svg class="share-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm6.527 17.635c-.328.246-.76.308-1.13.154l-3.145-1.308c-.37-.154-.616-.523-.616-.923v-4.03c0-1.2-.97-2.17-2.17-2.17s-2.17.97-2.17 2.17v.708c0 .4-.245.77-.615.923l-3.146 1.308c-.37.154-.802.092-1.13-.154s-.462-.677-.308-1.047l2.062-4.954a2.173 2.173 0 012.016-1.462h2.46c.97 0 1.81.646 2.077 1.57l2.062 4.953c.153.37.061.816-.308 1.047z"></path></svg>
                            <span data-translate="shareOnBlueskyButton">${translations[lang].shareOnBlueskyButton}</span>
                        </a>
                    </div>
                </div>
                <div class="donate-section">
                    <h3 class="donate-title" data-translate="donateSectionTitle">${translations[lang].donateSectionTitle}</h3>
                    <p class="donate-subtitle" data-translate="donateSubtitle">${translations[lang].donateSubtitle}</p>
                    <a href="#" class="donate-btn" id="donateBtn" target="_blank">
                        <span data-translate-dynamic="donateButtonText" data-amount="${uahAmount}">${translations[lang].donateButtonText.replace('{amount}', uahAmount)}</span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
                    </a>
                </div>`;
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });

            if (myChart) myChart.destroy();
            const ctx = document.getElementById('wasteChart').getContext('2d');
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: yearlyData.map(d => d.year.toString()),
                    datasets: [
                        {
                            label: translations[lang].totalPoop.replace('üí© ',''),
                            data: yearlyData.map(d => d.poop),
                            borderColor: '#A0522D', backgroundColor: 'rgba(160, 82, 45, 0.2)', fill: true, tension: 0.3
                        },
                        {
                            label: translations[lang].totalPee.replace('üíß ',''),
                            data: yearlyData.map(d => d.pee),
                            borderColor: '#FFD700', backgroundColor: 'rgba(255, 215, 0, 0.2)', fill: true, tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: `${translations[lang].unitKg} / ${translations[lang].unitLiters}` } },
                        x: { title: { display: true, text: translations[lang].labelAge } }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    if (context.parsed.y !== null) {
                                        label += formatNumber(context.parsed.y) + (context.datasetIndex === 0 ? ` ${translations[lang].unitKg}` : ` ${translations[lang].unitLiters}`);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
            // Re-bind event listeners for dynamically created buttons
            document.getElementById('shareXBtn').onclick = (e) => { e.preventDefault(); shareOnX(name, resultsData.poop, resultsData.pee); };
            document.getElementById('shareBlueskyBtn').onclick = (e) => { e.preventDefault(); shareOnBluesky(name, resultsData.poop, resultsData.pee); };
            document.getElementById('donateBtn').onclick = (e) => { e.preventDefault(); donatePoopAmount(resultsData.poop); };
        }

        // --- Share and Donate Functions (i18n aware for text) ---
        function shareOnX(name, poop, pee) {
            const urlToShare = "https://dovgonosyk.github.io/poopeelator/"; 
            const text = translations[currentLang].shareTextMessage
                .replace('{name}', name)
                .replace('{poopKg}', Math.round(poop))
                .replace('{peeLiters}', Math.round(pee))
                .replace('{url}', urlToShare);
            const encodedText = encodeURIComponent(text);
            const shareUrl = `https://twitter.com/intent/tweet?text=${encodedText}`;
            window.open(shareUrl, '_blank', 'width=550,height=420');
        }

        function shareOnBluesky(name, poop, pee) {
            const urlToShare = "https://dovgonosyk.github.io/poopeelator/"; 
            const text = translations[currentLang].shareTextMessage
                .replace('{name}', name)
                .replace('{poopKg}', Math.round(poop))
                .replace('{peeLiters}', Math.round(pee))
                .replace('{url}', urlToShare);
            const encodedText = encodeURIComponent(text);
            const shareUrl = `https://bsky.app/intent/compose?text=${encodedText}`;
            window.open(shareUrl, '_blank', 'width=550,height=420');
        }
        
        function donatePoopAmount(poopKg) {
            const donationUrl = `https://savelife.in.ua/en/donate-en/#donate-army-card`; 
            window.open(donationUrl, '_blank');
        }

        // --- Event Listeners and Initialization ---
        document.addEventListener('DOMContentLoaded', function() {
            const savedLang = localStorage.getItem('poopeelatorLang');
            if (savedLang && translations[savedLang]) {
                currentLang = savedLang;
            }
            document.getElementById('languageSelector').value = currentLang;
            applyTranslations(currentLang); 

            document.getElementById('languageSelector').addEventListener('change', function() {
                setLanguage(this.value);
            });

            const calculateBtn = document.getElementById('calculateBtn');
            if (calculateBtn) {
                calculateBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const nameInput = document.getElementById('name');
                    const ageInput = document.getElementById('age');
                    const genderInput = document.getElementById('gender');
                    const weightInput = document.getElementById('weight');
                    const heightInput = document.getElementById('height');

                    const name = nameInput.value.trim();
                    const age = parseFloat(ageInput.value);
                    const gender = genderInput.value;
                    const weight = parseFloat(weightInput.value);
                    const height = parseFloat(heightInput.value);
                    
                    let isValid = true;
                    [nameInput, ageInput, genderInput, weightInput, heightInput].forEach(input => {
                        if (!input.value || (input.type === "number" && (isNaN(parseFloat(input.value)) || parseFloat(input.value) < (input.min || 0) ) ) ) {
                            input.style.borderColor = 'red';
                            isValid = false;
                        } else {
                            input.style.borderColor = '#e2e8f0'; 
                        }
                    });
                     if (genderInput.value === "") { // Specifically check gender select
                        genderInput.style.borderColor = 'red';
                        isValid = false;
                    } else {
                        genderInput.style.borderColor = '#e2e8f0';
                    }


                    if (!isValid) {
                        const alertBoxId = 'custom-alert-box';
                        let alertBox = document.getElementById(alertBoxId);
                        if (!alertBox) {
                            alertBox = document.createElement('div');
                            alertBox.id = alertBoxId;
                            alertBox.style.cssText = 'position:fixed; top:20px; left:50%; transform:translateX(-50%); background:rgba(255,0,0,0.8); color:white; padding:15px 25px; border-radius:8px; z-index:1000; box-shadow: 0 4px 12px rgba(0,0,0,0.3); font-size: 1.1em; text-align:center;';
                            document.body.appendChild(alertBox);
                        }
                        alertBox.textContent = translations[currentLang].alertAllFields;
                        alertBox.style.display = 'block';
                        setTimeout(() => { if(alertBox) alertBox.style.display = 'none'; }, 3000);
                        return;
                    }
                    
                    const results = calculateLifetimeWaste_CALC(age, gender, weight, height);
                    const yearlyData = calculateLifetimeWasteByYear_CALC(age, gender, weight, height);
                    
                    window.lastCalculationData = { name, age, gender, weight, height, results, yearlyData };
                    displayResultsDOM(name, results, yearlyData, currentLang);
                });
            }
        });
    </script>
</body>
</html>
ÔøΩ